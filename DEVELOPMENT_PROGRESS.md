# 🚀 Cyberpunk FPS 개발 진행사항

## 📋 프로젝트 개요

**프로젝트명**: Cyberpunk FPS Game  
**개발 기간**: 2025년 1월  
**기술 스택**: Three.js, Cannon.js, Vite, ES6  
**플랫폼**: 웹 브라우저 (WebGL)  

## 🏗️ 아키텍처 설계

### 모듈 구조
- **GameEngine.js**: 3D 렌더링, 물리 시뮬레이션, 환경 생성
- **Player.js**: 플레이어 조작, 물리, 무기 시스템
- **Enemy.js**: AI 시스템, 적 타입별 행동 패턴
- **WeaponSystem.js**: 무기 및 발사체 시스템
- **UIManager.js**: 사용자 인터페이스 관리
- **main.js**: 게임 메인 로직, 이벤트 처리

### 기술적 특징
- **모듈형 설계**: ES6 모듈을 활용한 깔끔한 코드 구조
- **객체지향**: 각 게임 요소를 클래스로 구현
- **성능 최적화**: WebGL 제한사항을 고려한 최적화
- **물리 시뮬레이션**: Cannon.js를 이용한 현실적인 물리

## 🔄 개발 단계별 진행사항

### Phase 1: 기본 시스템 구축 ✅
**완료 날짜**: 2025-01-02

#### 주요 성과
- Three.js 기반 3D 렌더링 시스템 구축
- Cannon.js 물리 엔진 통합
- 기본 플레이어 이동 및 카메라 시스템
- 사이버펑크 환경 구성 (건물, 조명, 그리드)

#### 구현된 기능
- ✅ 3D 씬 생성 및 렌더링
- ✅ 물리 world 구성
- ✅ 플레이어 객체 생성
- ✅ 기본 조명 시스템
- ✅ 사이버펑크 스타일 환경

### Phase 2: 게임플레이 핵심 시스템 ✅
**완료 날짜**: 2025-01-02

#### 주요 성과
- 완전한 FPS 조작 시스템 구현
- 무기 시스템 및 발사체 물리
- AI 적 시스템 구축
- 충돌 감지 및 데미지 시스템

#### 구현된 기능
- ✅ 마우스 포인터 락 시스템
- ✅ WASD 이동 + 마우스 시점 조작
- ✅ 4종 무기 시스템 (권총, 라이플, 샷건, 저격총)
- ✅ 3타입 적 AI (기본, 빠름, 중장갑)
- ✅ 발사체 물리 시뮬레이션
- ✅ 체력 및 데미지 시스템

### Phase 3: UI 및 게임 시스템 ✅
**완료 날짜**: 2025-01-02

#### 주요 성과
- 완전한 UI 시스템 구축
- 스테이지 진행 시스템
- 게임 상태 관리
- 사이버펑크 스타일 UI 디자인

#### 구현된 기능
- ✅ 메인 메뉴 시스템
- ✅ HUD (체력, 점수, 탄약, 무기)
- ✅ 미니맵 시스템
- ✅ 알림 시스템
- ✅ 스테이지 진행 및 무기 해금 시스템
- ✅ 게임 오버 화면

### Phase 4: 버그 수정 및 최적화 ✅
**완료 날짜**: 2025-01-02

#### 주요 성과
- GPU 사용량 최적화 (100% → 정상 수준)
- WebGL 셰이더 오류 완전 해결
- 조작 시스템 정밀 조정
- 게임 밸런스 조정

#### 해결된 주요 이슈
- ✅ **GPU 100% 사용량 문제**: 포인트 라이트 제한, 셰이더 최적화
- ✅ **WebGL 셰이더 오류**: texture unit 제한 준수, Material 수정
- ✅ **마우스 조작 방향 오류**: 여러 차례 수정으로 정상화
- ✅ **적 위치 문제**: 공중 부유 문제 해결, 바닥 스폰 보장
- ✅ **HP 감소 오류**: 데미지 처리 파이프라인 수정
- ✅ **스테이지 무한 업그레이드**: 플래그 시스템으로 중복 실행 방지
- ✅ **점프 시스템**: 충돌 감지 개선, 관대한 점프 조건 적용

### Phase 5: 시각적 개선 ✅
**완료 날짜**: 2025-01-02

#### 주요 성과
- 조명 시스템 대폭 개선
- 맵 가시성 향상
- 더 밝고 선명한 게임 환경

#### 개선 사항
- ✅ **환경 조명**: 2.5 강도로 대폭 증가
- ✅ **주 조명**: 4.0 강도의 흰색 조명
- ✅ **배경색**: 밝은 회색톤으로 변경
- ✅ **건물 색상**: 더 밝은 색상으로 변경
- ✅ **포인트 라이트**: 강도 및 범위 증가

### Phase 6: FBX 모델 시스템 구현 ✅
**완료 날짜**: 2025-07-03

#### 주요 성과
- 리깅된 3D 캐릭터 모델 시스템 구현
- 타입별 애니메이션 시스템 구축
- 정확한 히트박스 및 충돌 감지 시스템
- 빌보드 UI 시스템으로 사용성 향상

#### 구현된 기능
- ✅ **FBXLoader 통합**: Three.js FBXLoader를 이용한 3D 모델 로딩
- ✅ **애니메이션 시스템**: AnimationMixer를 통한 실시간 애니메이션 재생
- ✅ **타입별 애니메이션**: 
  - 기본형: 걷기 애니메이션
  - 빠른형: 뛰기 애니메이션  
  - 중장갑형: 춤추기 애니메이션
- ✅ **정밀 히트박스**: 수평/수직 분리 충돌 감지 시스템
- ✅ **빌보드 UI**: 카메라를 향하는 체력바 및 타입 표시기
- ✅ **모델 중심 추적**: 정확한 충돌 감지를 위한 실시간 위치 계산

#### 기술적 개선사항
- **FBX 파일 구조**: biped/ 폴더에 체계적으로 관리
- **비동기 로딩**: Promise 기반 FBX 모델 로딩 시스템
- **폴백 시스템**: FBX 로딩 실패 시 기본 기하학적 모델 대체
- **메모리 관리**: 애니메이션 믹서 및 FBX 모델 적절한 dispose
- **성능 최적화**: 실시간 애니메이션과 UI 업데이트 최적화

## 🛠️ 기술적 해결사항

### WebGL 최적화
```javascript
// 포인트 라이트 제한으로 셰이더 오류 방지
if (this.pointLights.length >= 8) return;

// Material 타입 수정으로 emissive 오류 해결
MeshBasicMaterial → MeshPhongMaterial
```

### 물리 시스템 개선
```javascript
// 점프 시스템 개선
const isNearGround = this.body.position.y <= 3;
if (isNearGround || this.canJump) {
    // 점프 실행
}
```

### 게임 로직 최적화
```javascript
// 스테이지 무한 업그레이드 방지
if (this.score >= this.stageTargetScore && !this.stageCompleting) {
    this.stageCompleting = true;
    this.completeStage();
}
```

### FBX 모델 시스템
```javascript
// FBX 모델 로딩 및 애니메이션 시스템
async loadFBXModel() {
    const loader = new FBXLoader();
    return new Promise((resolve, reject) => {
        loader.load(fbxPath, (fbx) => {
            this.fbxModel = fbx;
            if (fbx.animations && fbx.animations.length > 0) {
                this.mixer = new THREE.AnimationMixer(fbx);
                this.currentAnimation = this.mixer.clipAction(fbx.animations[0]);
                this.currentAnimation.play();
            }
            resolve(fbx);
        });
    });
}

// 정밀 히트박스 시스템
intersectsProjectile(projectile) {
    const horizontalDistance = Math.sqrt(
        Math.pow(this.modelCenter.x - projectile.position.x, 2) + 
        Math.pow(this.modelCenter.z - projectile.position.z, 2)
    );
    const verticalDifference = Math.abs(this.modelCenter.y - projectile.position.y);
    
    return (horizontalDistance <= 4.0) && (verticalDifference <= 3.0);
}

// 빌보드 UI 시스템
updateHealthBarRotation() {
    if (this.healthBar && this.camera) {
        this.healthBar.lookAt(this.camera.position);
        this.typeIndicator.lookAt(this.camera.position);
    }
}
```

## 📊 성능 지표

### 최적화 전후 비교
- **GPU 사용량**: 100% → 30-50% (정상 범위)
- **WebGL 오류**: 빈번 발생 → 완전 해결
- **프레임레이트**: 불안정 → 안정적인 60fps
- **메모리 사용량**: 누수 → 정상적인 관리

### 현재 성능
- **렌더링**: 60fps 안정적 유지
- **물리 시뮬레이션**: 60fps로 실시간 처리
- **AI 업데이트**: 10fps로 효율적 처리
- **UI 업데이트**: 실시간 반응성

## 🎮 게임 밸런스 조정

### 적 속도 조정
- **기본형**: 25 → 20 (20% 감소)
- **빠른형**: 35 → 22 (37% 감소)
- **중장갑형**: 15 → 12 (20% 감소)

### 플레이어 능력 조정
- **이동 속도**: 12 → 15 (25% 증가)
- **점프 힘**: 15 → 25 (67% 증가)
- **마우스 감도**: 0.002 → 0.0005 (75% 감소)

### 스테이지 시스템
- **시간 제한**: 90초 → 45초 (단계별 감소)
- **목표 점수**: 300점 → 900점 (단계별 증가)
- **무기 해금**: 스테이지 클리어 시 순차 해금

## 🔄 현재 시스템 상태

### 완전 구현된 시스템
- ✅ 3D 렌더링 및 물리 시뮬레이션
- ✅ FPS 조작 시스템
- ✅ 무기 및 전투 시스템
- ✅ AI 적 시스템 (FBX 모델 기반)
- ✅ UI 및 HUD 시스템
- ✅ 스테이지 진행 시스템
- ✅ 점수 및 랭킹 시스템
- ✅ FBX 모델 및 애니메이션 시스템
- ✅ 빌보드 UI 시스템

### 최적화 완료 영역
- ✅ GPU 사용량 최적화
- ✅ WebGL 호환성
- ✅ 메모리 관리
- ✅ 물리 성능
- ✅ 조작 반응성

## 🚧 향후 개발 계획

### Phase 7: 콘텐츠 확장 (예정)
- [ ] 사운드 시스템 추가
- [ ] 파티클 이펙트 시스템
- [ ] 더 많은 무기 종류
- [ ] 다양한 맵 환경
- [ ] 더 많은 적 타입 및 애니메이션

### Phase 8: 고급 기능 (예정)
- [ ] 레벨 에디터
- [ ] 설정 메뉴 시스템
- [ ] 키 바인딩 커스터마이징
- [ ] 그래픽 옵션 설정
- [ ] 세이브/로드 시스템

### Phase 8: 멀티플레이어 (장기 계획)
- [ ] 서버 시스템 구축
- [ ] 실시간 멀티플레이어
- [ ] 매치메이킹 시스템
- [ ] 협동 모드
- [ ] 경쟁 모드

## 📚 학습 및 개발 노하우

### Three.js 최적화 팁
1. **조명 개수 제한**: 포인트 라이트는 8개 이하로 제한
2. **Material 선택**: 적절한 Material 타입 사용
3. **LOD 시스템**: 거리에 따른 디테일 조절
4. **Frustum Culling**: 보이지 않는 객체 렌더링 제외

### Cannon.js 활용법
1. **Body 최적화**: 복잡한 모양 대신 단순한 형태 사용
2. **Collision Group**: 불필요한 충돌 계산 제거
3. **Sleep 모드**: 정지된 객체의 계산 최소화
4. **Fixed Timestep**: 일정한 물리 업데이트 주기 유지

### 게임 아키텍처 패턴
1. **모듈화**: 기능별 독립적인 모듈 설계
2. **이벤트 시스템**: 느슨한 결합을 위한 이벤트 기반 통신
3. **상태 관리**: 중앙집중식 게임 상태 관리
4. **리소스 관리**: 메모리 누수 방지를 위한 적절한 dispose

## 🏆 성과 및 결과

### 기술적 성과
- **완전한 웹 기반 FPS 게임** 구현 완료
- **WebGL 최적화** 전문 지식 습득
- **물리 엔진 통합** 성공적 구현
- **성능 문제 해결** 능력 입증

### 게임플레이 성과
- **직관적인 조작 시스템** 구현
- **균형잡힌 게임 밸런스** 달성
- **몰입감 있는 사이버펑크 분위기** 조성
- **안정적인 60fps 게임플레이** 보장

### 코드 품질
- **모듈화된 아키텍처**로 유지보수성 확보
- **ES6 모던 JavaScript** 활용
- **명확한 주석**과 로깅 시스템
- **확장 가능한 구조** 설계

---

**최종 업데이트**: 2025년 7월 3일  
**개발 상태**: FBX 모델 시스템 구현 완료, 애니메이션 시스템 추가  
**다음 목표**: 사운드 시스템 및 파티클 이펙트 추가